python:
  - "2.7"

env:
  - LUA="luajit"

install:
  - sudo pip install autobahntestsuite
  - sudo apt-get install libev-dev
  - sudo apt-get install luajit
  - sudo apt-get install luarocks
  - sudo luarocks install luacov-coveralls
  - sudo luarocks install busted 1.11.1-1
  - sudo luarocks make rockspecs/lua-websockets-scm-1.rockspec

script:
  - cd test
  - wstest -m fuzzingserver &
  - sleep 10
  - lua ./autobahn_client_test.lua ws://127.0.0.1:9001
  - killall wstest
  - cd ..
  - ./test.sh

after_success:
  - luacov-coveralls
